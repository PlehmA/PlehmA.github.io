<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marcador de F√∫tbol</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        .marcador-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-top: 20px;
        }
        .scoreboard {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 15px;
            padding: 30px;
            color: white;
            margin-bottom: 30px;
        }
        .team-score {
            font-size: 4rem;
            font-weight: bold;
        }
        .team-name {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        .timer-display {
            font-size: 3rem;
            font-weight: bold;
            color: #ffd700;
        }
        .game-status {
            font-size: 1.2rem;
            color: #ffd700;
            margin-bottom: 15px;
        }
        .btn-gol {
            font-size: 1.2rem;
            padding: 15px 30px;
            margin: 10px;
        }
        .config-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        #img-festejo {
            display: none !important;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            max-width: 400px;
            width: 80%;
        }
        #img-festejo.show {
            display: block !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="marcador-container">
            <!-- Configuraci√≥n inicial (Vue) -->
            <div id="config-inicial" class="config-section" v-if="fase === 'pre'">
                <h2 class="text-center mb-4">Configurar Partido</h2>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Equipo Local</label>
                        <input type="text" class="form-control" id="equipo_local" v-model="equipoLocal">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Equipo Visitante</label>
                        <input type="text" class="form-control" id="equipo_visitante" v-model="equipoVisitante">
                    </div>
                </div>
                <div class="text-center">
                    <button type="button" class="btn btn-primary btn-lg" @click="iniciarPartido">Iniciar Partido</button>
                </div>
            </div>

            <!-- Marcador principal (Vue) -->
            <div id="marcador-principal" v-if="mostrarMarcador">
                <div class="scoreboard">
                    <div class="game-status text-center">{{ estadoTexto }}</div>
                    <div class="timer-display text-center mb-4">{{ tiempoFormateado }}</div>
                    
                    <div class="row align-items-center">
                        <div class="col-5 text-center">
                            <div class="team-name">{{ equipoLocal }}</div>
                            <div class="team-score">{{ marcadorConPenales(golesLocal, penalesLocal) }}</div>
                            <button class="btn btn-success btn-gol" @click="marcarGol('local')">‚öΩ Gol Local</button>
                        </div>
                        <div class="col-2 text-center">
                            <h2>VS</h2>
                        </div>
                        <div class="col-5 text-center">
                            <div class="team-name">{{ equipoVisitante }}</div>
                            <div class="team-score">{{ marcadorConPenales(golesVisitante, penalesVisitante) }}</div>
                            <button class="btn btn-danger btn-gol" @click="marcarGol('visitante')">‚öΩ Gol Visitante</button>
                        </div>
                    </div>
                </div>

                <!-- Controles del partido (Vue) -->
                <div class="text-center mb-3">
                    <button type="button" class="btn btn-primary btn-lg" v-if="fase === 'pre'" @click="iniciarPartido">‚ñ∂Ô∏è Empezar Primer Tiempo</button>
                    <button type="button" class="btn btn-success btn-lg" v-if="fase === 'mt'" @click="empezarSegundoTiempo" style="margin-left:8px;">‚ñ∂Ô∏è Empezar Segundo Tiempo</button>
                    <button type="button" class="btn btn-outline-light btn-lg" v-if="fase === 'primer'" @click="finalizarPrimerTiempo" style="margin-left:8px;">‚è≠Ô∏è Terminar Primer Tiempo</button>
                    <button type="button" class="btn btn-outline-light btn-lg" v-if="fase === 'segundo'" @click="finalizarPartido" style="margin-left:8px;">‚è≠Ô∏è Terminar Segundo Tiempo</button>
                    <button type="button" class="btn btn-warning btn-lg" v-if="mostrarControlesPausa && !pausado" @click="pausar" style="margin-left:8px;">‚è∏Ô∏è Pausar</button>
                    <button type="button" class="btn btn-info btn-lg" v-if="mostrarControlesPausa && pausado" @click="reanudar" style="margin-left:8px;">‚ñ∂Ô∏è Reanudar</button>
                </div>

                <!-- Alargues y Penales -->
                <div class="config-section">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <label class="form-label">Alargues: dos tiempos extra de 5 minutos cada uno</label>
                            <div class="small text-muted">Se mostrar√°n los controles autom√°ticamente si hay empate al finalizar el segundo tiempo.</div>
                        </div>
                        <div class="col-md-6">
                            <button type="button" class="btn btn-info btn-lg w-100" v-if="mostrarBotonAlargue" @click="iniciarAlargue1">‚è±Ô∏è Iniciar Primer Tiempo Extra (5')</button>
                        </div>
                    </div>
                    <div class="mt-3 text-center">
                        <button type="button" class="btn btn-primary" v-if="mostrarBotonPenales && fase !== 'penales'" @click="fase = 'penales'">‚öñÔ∏è Ir a Penales</button>
                        <button type="button" class="btn btn-secondary" @click="reiniciar">üîÑ Reiniciar Partido</button>
                    </div>

                    <!-- Panel de penales -->
                    <div class="mt-3" v-if="fase === 'penales' || penalesLocal > 0 || penalesVisitante > 0">
                        <h5 class="text-center">Penales</h5>
                        <div class="d-flex justify-content-center align-items-center mb-2">
                            <div class="me-3">{{ equipoLocal }}: <strong>{{ marcadorConPenales(golesLocal, penalesLocal) }}</strong></div>
                            <div class="ms-3">{{ equipoVisitante }}: <strong>{{ marcadorConPenales(golesVisitante, penalesVisitante) }}</strong></div>
                        </div>
                        <div class="d-flex justify-content-center gap-2">
                            <button class="btn btn-success" @click="marcarPenal('local')">Penal Local +1</button>
                            <button class="btn btn-danger" @click="marcarPenal('visitante')">Penal Visitante +1</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <img src="maradroga.gif" class="img-responsive" id="img-festejo" alt="Celebraci√≥n">
    </div>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script>
    const { createApp, ref, computed } = Vue;

    createApp({
        setup() {
            // Equipo y estado
            const equipoLocal = ref('Equipo Local');
            const equipoVisitante = ref('Equipo Visitante');

            // Goles y penales
            const golesLocal = ref(0);
            const golesVisitante = ref(0);
            const penalesLocal = ref(0);
            const penalesVisitante = ref(0);

            // Cron√≥metro y fases
            const segundos = ref(0);
            const intervalo = ref(null);
            const fase = ref('pre'); // pre, primer, mt, segundo, alargue1, alargue2, penales, final
            const pausado = ref(false);

            // Config: tiempos en segundos
            const tiempoPrimerSeg = 10 * 60; // 10 minutos por tiempo (seg√∫n archivo original)
            const alargueSeg = 5 * 60; // 5 minutos cada uno (requerido)

            const audio = new Audio('arbitro-futbol-.mp3');

            // Mostrar/ocultar secciones
            const mostrarMarcador = computed(() => fase.value !== 'pre');
            const estadoTexto = computed(() => {
                switch (fase.value) {
                    case 'pre': return 'Pre-partido';
                    case 'primer': return pausado.value ? 'Primer Tiempo - PAUSADO' : 'Primer Tiempo';
                    case 'mt': return 'Medio Tiempo';
                    case 'segundo': return pausado.value ? 'Segundo Tiempo - PAUSADO' : 'Segundo Tiempo';
                    case 'alargue1': return pausado.value ? 'Primer Tiempo Extra - PAUSADO' : 'Primer Tiempo Extra';
                    case 'alargue2': return pausado.value ? 'Segundo Tiempo Extra - PAUSADO' : 'Segundo Tiempo Extra';
                    case 'penales': return 'Penales';
                    case 'final': return 'Final del Partido';
                }
            });

            const tiempoFormateado = computed(() => {
                const m = Math.floor(segundos.value / 60);
                const s = segundos.value % 60;
                return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
            });

            // Cron√≥metro controlado
            function empezarCrono(limiteSegundos, onFinish) {
                clearInterval(intervalo.value);
                segundos.value = 0;
                pausado.value = false;
                intervalo.value = setInterval(() => {
                    segundos.value++;
                    if (segundos.value >= limiteSegundos) {
                        clearInterval(intervalo.value);
                        intervalo.value = null;
                        if (onFinish) onFinish();
                    }
                }, 1000);
            }

            function pausar() {
                if (intervalo.value) {
                    clearInterval(intervalo.value);
                    intervalo.value = null;
                    pausado.value = true;
                }
            }

            function reanudar() {
                if (!intervalo.value && pausado.value) {
                    pausado.value = false;
                    // Determinar l√≠mite seg√∫n fase y calcular remaining
                    const limite = fase.value === 'primer' || fase.value === 'segundo' ? tiempoPrimerSeg
                        : (fase.value === 'alargue1' || fase.value === 'alargue2') ? alargueSeg
                        : tiempoPrimerSeg;

                    const restante = Math.max(0, limite - segundos.value);
                    if (restante > 0) {
                        intervalo.value = setInterval(() => {
                            segundos.value++;
                            if (segundos.value >= limite) {
                                clearInterval(intervalo.value);
                                intervalo.value = null;
                                // llamar a la transici√≥n final seg√∫n fase
                                if (fase.value === 'primer') finalizarPrimerTiempo();
                                else if (fase.value === 'segundo') finalizarPartido();
                                else if (fase.value === 'alargue1' || fase.value === 'alargue2') finalizarAlargue();
                            }
                        }, 1000);
                    } else {
                        // Ya cumplido, disparar transicion
                        if (fase.value === 'primer') finalizarPrimerTiempo();
                        else if (fase.value === 'segundo') finalizarPartido();
                        else if (fase.value === 'alargue1' || fase.value === 'alargue2') finalizarAlargue();
                    }
                }
            }

            // Flujos del partido
            function iniciarPartido() {
                equipoLocal.value = document.getElementById('equipo_local').value || equipoLocal.value;
                equipoVisitante.value = document.getElementById('equipo_visitante').value || equipoVisitante.value;
                fase.value = 'primer';
                try { audio.play(); } catch(e){}
                empezarCrono(tiempoPrimerSeg, finalizarPrimerTiempo);
            }

            function finalizarPrimerTiempo() {
                fase.value = 'mt';
                try { audio.play(); } catch(e){}
                // En medio tiempo, mostrar bot√≥n para iniciar segundo
            }

            function empezarSegundoTiempo() {
                fase.value = 'segundo';
                try { audio.play(); } catch(e){}
                empezarCrono(tiempoPrimerSeg, finalizarPartido);
            }

            function finalizarPartido() {
                // Si hay empate despu√©s de 90' + alargues (o sin alargues) 
                // se decide si ir a penales o terminar seg√∫n la l√≥gica: aqu√≠ asumimos que
                // si estamos en 'segundo' y hay empate, el usuario podr√° iniciar alargues o penales.
                // Si ya vinimos de alargues y sigue empate, vamos a penales.
                if (fase.value === 'alargue1' || fase.value === 'alargue2') {
                    // Despu√©s de alargues comprobamos empate
                    if (golesLocal.value === golesVisitante.value) {
                        fase.value = 'penales';
                    } else {
                        fase.value = 'final';
                    }
                } else {
                    // Al finalizar segundo tiempo normal
                    if (golesLocal.value === golesVisitante.value) {
                        // dejar opci√≥n para alargues o ir directamente a penales con bot√≥n
                        fase.value = 'mt'; // usar medio para dar opci√≥n
                    } else {
                        fase.value = 'final';
                    }
                }
                try { audio.play(); } catch(e){}
            }

            function iniciarAlargue1() {
                fase.value = 'alargue1';
                try { audio.play(); } catch(e){}
                empezarCrono(alargueSeg, () => {
                    // despu√©s de primer alargue, si marcador igual, iniciar segundo alargue
                    if (golesLocal.value === golesVisitante.value) {
                        iniciarAlargue2();
                    } else {
                        fase.value = 'final';
                    }
                });
            }

            function iniciarAlargue2() {
                fase.value = 'alargue2';
                try { audio.play(); } catch(e){}
                empezarCrono(alargueSeg, () => {
                    // despu√©s del segundo alargue, si sigue empate, vamos a penales
                    if (golesLocal.value === golesVisitante.value) {
                        fase.value = 'penales';
                    } else {
                        fase.value = 'final';
                    }
                });
            }

            function marcarGol(localOVisitante) {
                if (localOVisitante === 'local') golesLocal.value++;
                else golesVisitante.value++;
                mostrarFestejo();
            }

            function marcarPenal(localOVisitante) {
                if (localOVisitante === 'local') penalesLocal.value++;
                else penalesVisitante.value++;
            }

            function mostrarFestejo() {
                const img = document.getElementById('img-festejo');
                img.classList.add('show');
                setTimeout(() => img.classList.remove('show'), 2500);
            }

            function reiniciar() {
                if (!confirm('¬øEst√°s seguro de que quieres reiniciar el partido?')) return;
                clearInterval(intervalo.value);
                intervalo.value = null;
                segundos.value = 0;
                golesLocal.value = 0;
                golesVisitante.value = 0;
                penalesLocal.value = 0;
                penalesVisitante.value = 0;
                fase.value = 'pre';
                pausado.value = false;
            }

            // Computeds para UI
            const mostrarBotonEmpezar = computed(() => fase.value === 'pre');
            const mostrarBotonEmpezarSegundo = computed(() => fase.value === 'mt' && golesLocal.value + golesVisitante.value >= 0);
            const mostrarControlesPausa = computed(() => ['primer','segundo','alargue1','alargue2'].includes(fase.value));
            const mostrarBotonAlargue = computed(() => fase.value === 'mt' && golesLocal.value === golesVisitante.value);
            const mostrarBotonPenales = computed(() => (fase.value === 'mt' && golesLocal.value === golesVisitante.value) || fase.value === 'penales');

            // Mostrar penales entre par√©ntesis al lado de cada n√∫mero si hay penales o estamos en penales
            function marcadorConPenales(goles, penales) {
                return penales > 0 ? `${goles} (${penales})` : `${goles}`;
            }

            return {
                equipoLocal, equipoVisitante,
                golesLocal, golesVisitante, penalesLocal, penalesVisitante,
                segundos, tiempoFormateado, estadoTexto, mostrarMarcador,
                iniciarPartido, empezarSegundoTiempo, iniciarAlargue1, iniciarAlargue2, marcarGol,
                finalizarPrimerTiempo, finalizarPartido,
                pausar, reanudar, reiniciar, marcarPenal, mostrarControlesPausa, pausado,
                mostrarBotonEmpezar, mostrarBotonEmpezarSegundo, mostrarBotonAlargue, mostrarBotonPenales,
                marcadorConPenales, fase, mostrarFestejo
            };
        }
    }).mount('body');
    </script>
</body>
</html>
